<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>T38</title>
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
  <link rel="stylesheet" href="/resources/demos/style.css">
  <style>  
    label, input { display:block; }
    input.text { margin-bottom:12px; width:95%; padding: .4em; }
    fieldset { padding:0; border:0; margin-top:25px; }
    h1 { font-size: 1.2em; margin: .6em 0; }
 
  body, select {
    font-size: 12px;
  }
  form {
    margin: 5px;
  }
  p {
    margin: 5px;
    font-size: 14px;
  }
  b {
    color: blue;
  }
  table, th, td {
  border: 1px solid black;
}
  </style>
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
</head>
<body>
<form id="form1">
	<br>
		<pre>Nimi </pre><input name="nimi"></input>
	<br>
		<pre>Osoite </pre><input name="osoite"></input>
	<br>
		<pre>Asiakastyyppi </pre>
		
			<select name="asty_avain" id="avaimet">

			</select>
	<br>
		<input type="button" onclick="showValues()" value="Etsi asiakas">	
</form>
		<button  onclick="logout()"  id="nappula2">logout</button>

	<button id="create-user" disabled>Luo uusi asiakas</button>
	<br>
	
 <table id="osoitteet" style="width:70%">
    <th>Avain</th>
    <th>Nimi</th>
    <th>Osoite</th>
    <th>Postinro</th>
	<th>Toimipaikka</th>
    <th>Luotu</th>
    <th>Osoite</th>
</table> 
  <iframe name="huijausikkuna" style="display:none;"></iframe>

<div id="dialog-form" title="Rekisteröityminen">

  <form id="form2" target="huijausikkuna">
    <fieldset>
      <label for="nimi">Nimi</label>
      <input type="text" name="nimi" id="name" value="Testinimi">
	  <br>
      <label for="osoite">Osoite</label>
      <input type="text" name="osoite" id="os" value="Kauppakatu 7 a 2">
	  <br>
      <label for="postinro">postinro</label>
      <input type="text" name="postinro" id="pstnro" value="00100">
	  <br>
      <label for="postitmp">postitmp</label>
      <input type="text" name="postitmp" id="tmpk" value="Helsinki">
	  <br>
      <label for="luontipvm">luontipvm</label>
      <input type="text" name="luontipvm" id="lpvm" value="2019-10-10">
	        <label for="avain">avain</label>
      <input type="text" name="avain" id="key" value="" readonly>
	  <p>asty_avain</p>
	  
      	<select name="asty_avain" id="asty" >
			<option value="1">YRITYSASIAKAS</option>
			<option value="2">KULUTTAJA ASIAKAS</option>
			<option value="3">Rahoittaja Asiakas</option>
			<option value="4">Joukkue asiakas</option>
		</select>	
		<button form="form2" onclick="update()" id="nappula">Päivitä</button>
    </fieldset>
  </form>
</div>

<script>
 $(document).ready(function(){
    $.get("http://localhost:3002/Types", function(data, status){
    let addStr = '';
    for (x in data){
    	let myObj = data[x];			 		 
		$('#avaimet').append($('<option/>', { 
        value: myObj.Avain,
        text : myObj.Lyhenne 
		    }));
    
	}
	});
			$('#avaimet').append($('<option/>', { 
        value: "",
        text : "Tyhja" 
		    }));
  });
  

      function logout()
       {
	str = "http://localhost:3002/logout";
    $.get(str, function() {
  alert( "Uloskirjautuminen onnistui!" );
   location.reload(); 
});
}
	  
 function showValues() {
    var str = $( "#form1" ).serialize();
	str = ("http://localhost:3002/asiakas?" + str)	
	add_to_table(str);
	}	
	
function add_to_table(str){
    $.get(str, function(data, status){
    let addStr = '';
    let i = 0;	
	let MyTable =  document.getElementById("osoitteet");  
	
		for (x in data){
		var NewRow = MyTable.insertRow(1);
		i = 0;			 
    	let myObj = data[x];
			for (y in myObj){
				var Newcell = NewRow.insertCell(i); 
					if(i==0){
						var btn = document.createElement("BUTTON");
						btn.innerHTML = "Edir Row";
						btn.type ="submit";
						btn.value = myObj[y];
						btn.onclick = Edit_row;
						Newcell.innerHTML = myObj[y];			
						Newcell.prepend(btn); 
						i++;
					}else{
						Newcell.innerHTML = myObj[y]; 
						i++;
					}
			}
		}
    });
 };//add_to_table
  
  function Remove_row() {
    var str ="https://codez.savonia.fi/jussi/api/asiakas/poista.php?avain=" + $(this).val();
    $.get(str);
	let node = this.parentElement.parentElement.remove();
	return
 }
 
   function Edit_row() {
	 var jqxhr = $.get("http://localhost:3002/Asiakas/"+$(this).val(), function(data){

	  document.getElementById("name").value = data[0]['NIMI'];
	  document.getElementById("os").value = data[0]['OSOITE'];
	  document.getElementById("pstnro").value = data[0]['POSTINRO'];
	  document.getElementById("tmpk").value = data[0]['POSTITMP'];
	  document.getElementById("lpvm").value = data[0]['LUONTIPVM'];
	  document.getElementById("asty").value = data[0]['ASTY_AVAIN'];
	  	  document.getElementById("key").value = data[0]['AVAIN'];

});

       var dialog, form,
    dialog = $( "#dialog-form" ).dialog({
      autoOpen: false,
      height: 450,
      width: 250,
      modal: true,
      buttons: {
        Cancel: function() {
          dialog.dialog( "close" );
         },
	  }
    });
    form = dialog.find( "#nappula" ).on( "click", function( event ) {		
	dialog.dialog( "close" );
	alert("Katso console onnistuiko päivitys")
       });
	      dialog.dialog( "open" );


	return
 };

/*
function post_CB(){
$.post('http://localhost:3002/asiakas?', function(data) {
    $('#huijausikkuna').html(data);
	var str = $( "#form2" ).serialize();	
	str = ("https://codez.savonia.fi/jussi/api/asiakas/haku.php?" + str);
	add_to_table(str);
	
}, 'html');	
}*/

function update(){
	var str = $( "#form2" ).serialize();
$.ajax({
    url: 'http://localhost:3002/asiakas/update?'+str,
    type: 'PUT',
    success: function(data) {
	console.log("Tietojen päivitys onnistui")
    }
});	
}

$( function() {
    var dialog, form,
  
    dialog = $( "#dialog-form" ).dialog({
      autoOpen: false,
      height: 450,
      width: 250,
      modal: true,
      buttons: {
        Cancel: function() {
          dialog.dialog( "close" );
         },
	  }
    });
    form = dialog.find( "#nappula" ).on( "click", function( event ) {		
	dialog.dialog( "close" );
	
	  //  var str ="https://codez.savonia.fi/jussi/api/asiakas/tyypit.php";
    	
    });
    $( "#create-user" ).button().on( "click", function() {
      dialog.dialog( "open" );
	   var avain=13
	      $.get("http://localhost:3002/Asiakas/"+avain, function(data, status){

	  document.getElementById("name").value = data[0]['NIMI'];
	  document.getElementById("os").value = data[0]['OSOITE'];
	  document.getElementById("pstnro").value = data[0]['POSTINRO'];
	  document.getElementById("tmpk").value = data[0]['POSTITMP'];
	  document.getElementById("lpvm").value = data[0]['LUONTIPVM'];
	  document.getElementById("asty").value = data[0]['ASTY_AVAIN'];
});
    });
 })
 
 ;

</script>

</body>
</html>